<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Descarga los mejores juegos para Nintendo Switch - The Cimber">
    <meta name="theme-color" content="#232323">
    <meta name="color-scheme" content="dark light">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="img/logo.png" as="image" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <title>The Cimber</title>
    
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="img/favicon.png">
</head>
<body>

    <header class="site-header">
        <div class="header-top" role="banner">
            <img src="img/logo.png" alt="Logo thecimber" class="logo" width="56" height="56" loading="eager">
            <h1 class="visually-hidden"></h1>
            <div class="social-links">
                <a href="#" class="social-link" aria-label="Síguenos en Facebook" title="Facebook">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="#" class="social-link" aria-label="Síguenos en TikTok" title="TikTok">
                    <i class="fab fa-tiktok"></i>
                </a>
                <a href="#" class="social-link" aria-label="Síguenos en YouTube" title="YouTube">
                    <i class="fab fa-youtube"></i>
                </a>
                <a href="#" class="social-link" aria-label="Síguenos en Telegram" title="Telegram">
                    <i class="fab fa-telegram"></i>
                </a>
            </div>
            <div class="language-selector">
                <button class="language-btn" id="language-toggle">
                    <span class="current-lang">ES</span>
                    <span class="lang-separator">/</span>
                    <span class="alt-lang">EN</span>
                </button>
            </div>
        </div>
        

        <div class="search-container" role="search">
            <label for="search-bar" class="visually-hidden"></label>
            <input type="search" 
                   id="search-bar" 
                   placeholder="Buscar juego por título..."
                   aria-label="Buscar juego por título"
                   autocomplete="off"
                   spellcheck="false">
        </div>
    </header>

    <main id="main-content" class="main-content">
        <div class="main-container">
            <!-- Sección de últimos videos -->
            <div class="youtube-container">
                <h2 id="youtube-heading" data-translate="latestVideos">Últimos Videos</h2>
                <div id="youtube-videos" class="youtube-grid">
                    <!-- Los videos se cargarán aquí dinámicamente -->
                </div>
            </div>
            <section class="game-section" aria-labelledby="games-heading">
                <h2 id="games-heading" class="visually-hidden"></h2>
                <div class="sub-boxes" role="list">
                    <!-- Fila 1 -->
                    <article class="sub-box" role="listitem">
                        <img src="img/zelda.jpg" alt="Zelda: BOTW" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Zelda: Breath of the Wild</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v1.8.2 Update + 2 DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/mario.png" alt="Mario Odyssey" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Super Mario Odyssey</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v1.4.1 Update</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/pokemon.png" alt="Pokémon Scarlet" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Pokémon Scarlet</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v4.0.0 Update + The Hidden Treasure of Area Zero DLC (Part 1: The Teal Mask and Part 2: The Indigo Disk)</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/metroid.png" alt="Metroid Dread" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Metroid Dread</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v2.1.0 Update</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/mariokart.png" alt="Mario Kart 8" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Mario Kart 8 Deluxe</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v3.0.4 Update + All DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <!-- Fila 2 -->
                    <article class="sub-box" role="listitem">
                        <img src="img/smash.png" alt="Smash Bros Ultimate" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Super Smash Bros Ultimate</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v13.0.4 Update + All DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/animal.png" alt="Animal Crossing" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Animal Crossing: New Horizons</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v2.0.7 Update + 3 DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/splatoon.png" alt="Splatoon 3" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Splatoon 3</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v10.0.1 Update + 3 DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/xenoblade.png" alt="Xenoblade 3" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">Xenoblade Chronicles 3</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v2.2.1 Update + 4 DLCs</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <article class="sub-box" role="listitem">
                        <img src="img/zelda2.png" alt="Fire Emblem" class="sub-box__image" loading="lazy">
                        <h3 class="sub-box__title">The Legend of Zelda: Echoes of Wisdom</h3>
                        <p class="sub-box__desc">NSP, XCI ROM + v1.1.0 Update</p>
                        <div class="sub-box__actions">
                            <button class="action-btn switch-btn">Switch</button>
                            <button class="action-btn download-btn">Descargar</button>
                        </div>
                    </article>

                    <!-- Continuar con más juegos hasta completar 20 -->
                    <!-- Resto de los sub-boxes siguen el mismo patrón -->
                </div>
            </section>
        </div>
    </main>

    <!-- Modal optimizado -->
    <dialog id="download-modal" class="modal">
        <div class="modal-content" role="document">
            <button class="modal-close" 
                    id="download-modal-close" 
                    aria-label="Cerrar modal"
                    title="Cerrar">&times;</button>
            <div class="modal-body">
                <div class="modal-header">
                    <img id="modal-game-image" class="modal-game-image" alt="" loading="lazy">
                    <h2 id="modal-title">Zelda: Breath of the Wild</h2>
                </div>
                <div class="modal-info">
                    <div class="game-details">
                        <div class="detail-row">
                            <span class="detail-label">Release Date:</span>
                            <span class="detail-value" id="modal-release-date">March 3, 2017</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Genre:</span>
                            <span class="detail-value" id="modal-genre">Adventure Action Role-playing</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Publisher:</span>
                            <span class="detail-value" id="modal-publisher">Nintendo</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ROM Format:</span>
                            <span class="detail-value" id="modal-format">NSP, XCI</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Game Version:</span>
                            <span class="detail-value" id="modal-version">1.8.0</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">System:</span>
                            <span class="detail-value" id="modal-system">Nintendo Switch</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Firmware Required:</span>
                            <span class="detail-value" id="modal-firmware">20.0.1</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Languages:</span>
                            <span class="detail-value" id="modal-languages">Dutch, English, French, German, Italian, Japanese, Russian, Spanish</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Players:</span>
                            <span class="detail-value" id="modal-players">Single System (1)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ESRB Rating:</span>
                            <span class="detail-value" id="modal-rating">Everyone 10+</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Play Modes:</span>
                            <span class="detail-value" id="modal-modes">TV mode, Tabletop mode, Handheld mode</span>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <a href="#" class="action-btn download-link" rel="noopener" download>Descargar NSP</a>
                        <a href="#" class="action-btn download-link" rel="noopener" download>Descargar XCI</a>
                        <a href="#" class="action-btn download-link" rel="noopener" download>Descargar Update</a>
                        <a href="#" class="action-btn download-link" rel="noopener" download>Descargar DLC</a>
                    </div>
                </div>
            </div>
        </div>
    </dialog>
    <!-- Script optimizado -->
    <script type="module">


        // Traducciones
        const translations = {
            en: {
                searchPlaceholder: "Search game by title...",
                downloadBtn: "Download",
                switchBtn: "Switch",
                modalClose: "Close",
                noResults: "No games found matching your search",
                releaseDate: "Release Date",
                genre: "Genre",
                publisher: "Publisher",
                romFormat: "ROM Format",
                gameVersion: "Game Version",
                system: "System",
                firmware: "Firmware Required",
                languages: "Languages",
                players: "Players",
                rating: "ESRB Rating",
                modes: "Play Modes",
                downloadNSP: "Download NSP",
                downloadXCI: "Download XCI",
                downloadUpdate: "Download Update",
                downloadDLC: "Download DLC",
                latestVideos: "Latest Videos"
            },
            es: {
                searchPlaceholder: "Buscar juego por título...",
                downloadBtn: "Descargar",
                switchBtn: "Switch",
                modalClose: "Cerrar",
                noResults: "No se encontraron juegos que coincidan con tu búsqueda",
                releaseDate: "Fecha de Lanzamiento",
                genre: "Género",
                publisher: "Desarrollador",
                romFormat: "Formato ROM",
                gameVersion: "Versión del Juego",
                system: "Sistema",
                firmware: "Firmware Requerido",
                languages: "Idiomas",
                players: "Jugadores",
                rating: "Clasificación ESRB",
                modes: "Modos de Juego",
                downloadNSP: "Descargar NSP",
                downloadXCI: "Descargar XCI",
                downloadUpdate: "Descargar Update",
                downloadDLC: "Descargar DLC",
                latestVideos: "Últimos Videos"
            }
        };

        // Sistema de idiomas
        let currentLang = localStorage.getItem('language') || 'es';
        const langToggle = document.getElementById('language-toggle');
        
        const updateLanguage = (lang) => {
            currentLang = lang;
            localStorage.setItem('language', lang);
            
            // Actualizar textos
            document.getElementById('search-bar').placeholder = translations[lang].searchPlaceholder;
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.textContent = translations[lang].downloadBtn;
            });
            document.querySelectorAll('.switch-btn').forEach(btn => {
                btn.textContent = translations[lang].switchBtn;
            });
            
            // Actualizar modal
            document.querySelector('#download-modal-close').title = translations[lang].modalClose;
            document.querySelectorAll('.detail-label').forEach(label => {
                const key = label.textContent.toLowerCase().replace(/[^a-z]/g, '');
                if (translations[lang][key]) {
                    label.textContent = translations[lang][key] + ':';
                }
            });
            
            // Actualizar botones de descarga del modal
            const downloadLinks = document.querySelectorAll('.download-link');
            downloadLinks[0].textContent = translations[lang].downloadNSP;
            downloadLinks[1].textContent = translations[lang].downloadXCI;
            downloadLinks[2].textContent = translations[lang].downloadUpdate;
            downloadLinks[3].textContent = translations[lang].downloadDLC;
            
            // Actualizar visual del botón
            const currentLangSpan = langToggle.querySelector('.current-lang');
            const altLangSpan = langToggle.querySelector('.alt-lang');
            currentLangSpan.textContent = lang.toUpperCase();
            altLangSpan.textContent = (lang === 'es' ? 'EN' : 'ES');
            
            // Actualizar mensaje de no resultados si existe
            const noResults = document.getElementById('no-results');
            if (noResults) {
                noResults.textContent = translations[lang].noResults;
            }

            // Actualizar título de la sección de YouTube
            document.querySelector('[data-translate="latestVideos"]').textContent = translations[lang].latestVideos;
        };

        // Evento para cambiar idioma
        langToggle.addEventListener('click', () => {
            const newLang = currentLang === 'es' ? 'en' : 'es';
            updateLanguage(newLang);
        });

        // Inicializar idioma
        updateLanguage(currentLang);

        // Calcular el ancho de la barra de desplazamiento
        const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
        document.documentElement.style.setProperty('--scrollbar-width', `${scrollbarWidth}px`);

        // Sistema de búsqueda
        const searchBar = document.getElementById('search-bar');
        const subBoxes = document.querySelectorAll('.sub-box');

        const filterGames = (searchTerm) => {
            const normalizedSearch = searchTerm.toLowerCase().trim();
            
            subBoxes.forEach(box => {
                const title = box.querySelector('.sub-box__title').textContent.toLowerCase();
                const description = box.querySelector('.sub-box__desc').textContent.toLowerCase();
                const isMatch = title.includes(normalizedSearch) || 
                              description.includes(normalizedSearch);

                // Añadir/remover clase para la animación
                if (isMatch) {
                    box.classList.remove('hidden');
                    setTimeout(() => box.classList.add('visible'), 10);
                } else {
                    box.classList.remove('visible');
                    setTimeout(() => box.classList.add('hidden'), 300);
                }
            });

            // Actualizar mensaje de no resultados
            const noResultsMsg = document.getElementById('no-results');
            const hasVisibleBoxes = Array.from(subBoxes).some(box => !box.classList.contains('hidden'));
            
            if (!hasVisibleBoxes && searchTerm.length > 0) {
                if (!noResultsMsg) {
                    const msg = document.createElement('p');
                    msg.id = 'no-results';
                    msg.className = 'no-results-message';
                    msg.textContent = 'No se encontraron juegos que coincidan con tu búsqueda';
                    document.querySelector('.sub-boxes').appendChild(msg);
                }
            } else if (noResultsMsg) {
                noResultsMsg.remove();
            }
        };

        // Evento de búsqueda con debounce para mejor rendimiento
        let searchTimeout;
        searchBar.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                filterGames(e.target.value);
            }, 300);
        });

        // Intersection Observer para lazy loading mejorado
        const observerOptions = {
            root: null,
            rootMargin: '50px',
            threshold: 0.1
        };

        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                    observer.unobserve(img);
                }
            });
        }, observerOptions);

        // Optimización de imágenes
        document.querySelectorAll('.sub-box__image').forEach(img => {
            imageObserver.observe(img);
        });

        // Modal con mejor rendimiento
        const downloadButtons = document.querySelectorAll('.download-btn');
        const downloadModal = document.getElementById('download-modal');
        const downloadModalClose = document.getElementById('download-modal-close');

        const gameDetails = {
            'Zelda: Breath of the Wild': {
                releaseDate: 'March 3, 2017',
                genre: 'Adventure Action Role-playing',
                publisher: 'Nintendo',
                format: 'NSP, XCI',
                version: '1.8.0',
                system: 'Nintendo Switch',
                firmware: '20.0.1',
                languages: 'Dutch, English, French, German, Italian, Japanese, Russian, Spanish',
                players: 'Single System (1)',
                rating: 'Everyone 10+',
                modes: 'TV mode, Tabletop mode, Handheld mode'
            }
            // Agregar más juegos aquí con su información correspondiente
        };

        const openDownloadModal = (event) => {
            event.preventDefault();
            const subBox = event.target.closest('.sub-box');
            const title = subBox.querySelector('.sub-box__title').textContent;
            const gameImage = subBox.querySelector('.sub-box__image');
            const gameInfo = gameDetails[title] || {};
            
            // Actualizar imagen y título
            const modalImage = downloadModal.querySelector('#modal-game-image');
            modalImage.src = gameImage.src;
            modalImage.alt = gameImage.alt;
            downloadModal.querySelector('#modal-title').textContent = title;
            
            // Actualizar todos los detalles del juego
            if (gameInfo) {
                downloadModal.querySelector('#modal-release-date').textContent = gameInfo.releaseDate || 'N/A';
                downloadModal.querySelector('#modal-genre').textContent = gameInfo.genre || 'N/A';
                downloadModal.querySelector('#modal-publisher').textContent = gameInfo.publisher || 'N/A';
                downloadModal.querySelector('#modal-format').textContent = gameInfo.format || 'N/A';
                downloadModal.querySelector('#modal-version').textContent = gameInfo.version || 'N/A';
                downloadModal.querySelector('#modal-system').textContent = gameInfo.system || 'Nintendo Switch';
                downloadModal.querySelector('#modal-firmware').textContent = gameInfo.firmware || 'N/A';
                downloadModal.querySelector('#modal-languages').textContent = gameInfo.languages || 'N/A';
                downloadModal.querySelector('#modal-players').textContent = gameInfo.players || 'N/A';
                downloadModal.querySelector('#modal-rating').textContent = gameInfo.rating || 'N/A';
                downloadModal.querySelector('#modal-modes').textContent = gameInfo.modes || 'N/A';
            }

            downloadModal.showModal();
            document.body.classList.add('modal-open');
            downloadModal.classList.add('show');
        };

        const closeDownloadModal = () => {
            downloadModal.classList.remove('show');
            document.body.classList.remove('modal-open');
            setTimeout(() => {
                downloadModal.close();
            }, 300);
        };

        // Event delegation para mejor rendimiento
        document.addEventListener('click', (e) => {
            if (e.target.closest('.download-btn')) {
                openDownloadModal(e);
            } else if (e.target === downloadModal || e.target === downloadModalClose) {
                closeDownloadModal();
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && downloadModal.open) {
                closeDownloadModal();
            }
        });

        // Actualización de videos de YouTube
        const YOUTUBE_API_KEY = 'AIzaSyCYqwtnIb3EHk2IySfR3vRzUuBYPGg8-GM'; // Reemplaza con tu API key de YouTube
        const CHANNEL_ID = 'UCviFA6aOB0Q_mir7KZluJAg'; // Reemplaza con el ID de tu canal
        const MAX_RESULTS = 3;

        async function fetchLatestVideos() {
            try {
                const cacheKey = 'youtubeVideos';
                const cacheExpiry = 3600000; // 1 hora en milisegundos
                const cachedData = localStorage.getItem(cacheKey);
                
                if (cachedData) {
                    const { data, timestamp } = JSON.parse(cachedData);
                    if (Date.now() - timestamp < cacheExpiry) {
                        renderVideos(data.items);
                        return;
                    }
                }

                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${YOUTUBE_API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=${MAX_RESULTS}`);
                const data = await response.json();
                
                if (data.items) {
                    localStorage.setItem(cacheKey, JSON.stringify({
                        data,
                        timestamp: Date.now()
                    }));
                    renderVideos(data.items);
                }
            } catch (error) {
                console.error('Error fetching YouTube videos:', error);
            }
        }

        function renderVideos(items) {
            const videosContainer = document.getElementById('youtube-videos');
            if (!videosContainer) return;

            const fragment = document.createDocumentFragment();
            
            items.forEach(item => {
                if (item.id.videoId) {
                    const videoDate = new Date(item.snippet.publishedAt);
                    const formattedDate = videoDate.toLocaleDateString(currentLang === 'es' ? 'es-ES' : 'en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    const videoElement = document.createElement('div');
                    videoElement.className = 'youtube-video';
                    videoElement.innerHTML = `
                        <a href="https://www.youtube.com/watch?v=${item.id.videoId}" target="_blank" rel="noopener noreferrer">
                            <img src="${item.snippet.thumbnails.high.url}" alt="${item.snippet.title}" class="video-thumbnail" loading="lazy">
                            <div class="video-info">
                                <h3 class="video-title">${item.snippet.title}</h3>
                                <span class="video-date">${formattedDate}</span>
                            </div>
                        </a>
                    `;
                    fragment.appendChild(videoElement);
                }
            });

            videosContainer.innerHTML = '';
            videosContainer.appendChild(fragment);
        }

        // Cargar videos al inicio
        fetchLatestVideos();

        // Actualizar videos cada hora
        setInterval(fetchLatestVideos, 3600000);



        // Intersection Observer para elementos animados
        const fadeObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    entry.target.classList.remove('fade-out');
                } else {
                    entry.target.classList.add('fade-out');
                    entry.target.classList.remove('fade-in');
                }
            });
        }, {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        });

        // Observar la sección de YouTube
        const youtubeContainer = document.querySelector('.youtube-container');
        if (youtubeContainer) {
            fadeObserver.observe(youtubeContainer);
        }
    </script>
</body>
</html>